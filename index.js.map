{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport default function getImagesByQuery(query, page) {\n  const params = {\n    key: '53321063-39b236969f2c986560565235a',\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page: page,\n    per_page: 15,\n  };\n  return axios\n    .get('https://pixabay.com/api/', { params })\n    .then(res => res.data);\n}\n","import SimpleLightbox from 'simplelightbox';\n\nconst loader = document.querySelector('.loader');\nconst loadMoreButton = document.querySelector('.load-more');\nconst galleryElem = document.querySelector('.gallery');\n\nlet gallery = new SimpleLightbox('.gallery a', {\n  captions: true,\n  captionsData: 'alt',\n  captionPosition: 'bottom',\n  captionDelay: 250,\n  overlay: true,\n  overlayOpacity: 0.8,\n});\n\nexport function createGallery(images) {\n  const markup = imagesTemplate(images);\n  galleryElem.insertAdjacentHTML('beforeend', markup);\n  gallery.refresh();\n}\n\nexport function clearGallery() {\n  galleryElem.innerHTML = '';\n}\n\nexport function showLoader() {\n  loader.classList.remove('hidden');\n}\n\nexport function hideLoader() {\n  loader.classList.add('hidden');\n}\n\nexport function showLoadMoreButton() {\n  loadMoreButton.classList.remove('hidden');\n}\n\nexport function hideLoadMoreButton() {\n  loadMoreButton.classList.add('hidden');\n}\n\nfunction imagesTemplate(images) {\n  return images.map(imageTemplate).join('');\n}\n\nfunction imageTemplate(image) {\n  const {\n    webformatURL,\n    largeImageURL,\n    tags,\n    likes,\n    views,\n    comments,\n    downloads,\n  } = image;\n  return `<li class=\"gallery-item\">\n    <a class=\"gallery-link\" href=\"${largeImageURL}\">\n      <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n    </a>\n    <ul class=\"image-info\">\n      <li class=\"info-point\">\n        <p class=\"info-point-label\">Likes</p>\n        <p class=\"info-point-value\">${likes}</p>\n      </li>\n      <li class=\"info-point\">\n        <p class=\"info-point-label\">Views</p>\n        <p class=\"info-point-value\">${views}</p>\n      </li>\n      <li class=\"info-point\">\n        <p class=\"info-point-label\">Comments</p>\n        <p class=\"info-point-value\">${comments}</p>\n      </li>\n      <li class=\"info-point\">\n        <p class=\"info-point-label\">Downloads</p>\n        <p class=\"info-point-value\">${downloads}</p>\n      </li>\n    </ul>\n  </li>`;\n}\n","import iziToast from 'izitoast';\nimport getImagesByQuery from './js/pixabay-api';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n} from './js/render-functions';\n\nlet query;\nlet currentPage;\nlet totalPages;\nconst form = document.querySelector('.form');\nconst loadMoreButton = document.querySelector('.load-more');\nconst observer = new IntersectionObserver(entries => {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      showMessage(`We're sorry, but you've reached the end of search results`);\n    }\n  });\n});\n\nform.addEventListener('submit', formSubmitHandler);\nloadMoreButton.addEventListener('click', loadMore);\n\nasync function formSubmitHandler(e) {\n  e.preventDefault();\n  const queryCandidate = form.elements['search-text'].value.trim();\n  if (!queryCandidate) {\n    return;\n  }\n  hideLoadMoreButton();\n  clearGallery();\n  showLoader();\n\n  query = queryCandidate;\n  currentPage = 1;\n\n  form.reset();\n  try {\n    const { hits: images, totalHits: totalImages } = await getImagesByQuery(\n      query,\n      currentPage\n    );\n    totalPages = Math.ceil(totalImages / 15);\n\n    images.length > 0\n      ? createGallery(images)\n      : showMessage(\n          'Sorry, there are no images matching your search query. Please try again!'\n        );\n    if (totalPages > 1) {\n      showLoadMoreButton();\n    }\n    endGalleryHandler();\n  } catch (err) {\n    console.error(err);\n  }\n  hideLoader();\n}\n\nasync function loadMore() {\n  showLoader();\n  currentPage += 1;\n  try {\n    const { hits: images } = await getImagesByQuery(query, currentPage);\n    createGallery(images);\n    endGalleryHandler();\n    scrollGallery();\n  } catch (err) {\n    console.error(err);\n  }\n  hideLoader();\n}\n\nfunction showMessage(message) {\n  iziToast.show({\n    message: message,\n    position: 'topRight',\n    maxWidth: '432px',\n    color: 'blue',\n  });\n}\n\nfunction scrollGallery() {\n  const card = document.querySelector('.gallery-item');\n  const cardHeight = card.getBoundingClientRect().height;\n  const gapPx = getComputedStyle(document.querySelector('.gallery')).gap;\n  const gap = parseInt(gapPx, 10);\n  const scrollHeight = cardHeight * 2 + gap;\n\n  window.scrollBy({\n    top: scrollHeight,\n    behavior: 'smooth',\n  });\n}\n\nfunction endGalleryHandler() {\n  if (currentPage !== totalPages) {\n    return;\n  }\n  hideLoadMoreButton();\n  const target = document.querySelector('.gallery .gallery-item:last-child');\n  observer.observe(target);\n}\n"],"names":["getImagesByQuery","query","page","params","axios","res","loader","loadMoreButton","galleryElem","gallery","SimpleLightbox","createGallery","images","markup","imagesTemplate","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","imageTemplate","image","webformatURL","largeImageURL","tags","likes","views","comments","downloads","currentPage","totalPages","form","observer","entries","entry","showMessage","formSubmitHandler","loadMore","queryCandidate","totalImages","endGalleryHandler","err","scrollGallery","message","iziToast","cardHeight","gapPx","gap","scrollHeight","target"],"mappings":"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"}